### –ù–∞—á–∏–Ω–∞–µ–º –≤—Å–ø–æ–º–∏–Ω–∞—Ç—å ATL

–†–∞–∑ —É–∂ —è —Ä–µ—à–∏–ª —É—Å—Ç—Ä–æ–∏—Ç—å –≤ –±–ª–æ–≥–µ ¬´–ø–∞—Ä–∞–¥ –¥—Ä–µ–≤–Ω–æ—Å—Ç–µ–π¬ª, —Ç–æ –Ω–µ–ª—å–∑—è –æ–±–æ–π—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ–º —Ç–∞–∫—É—é —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é –∫–∞–∫ ATL (Active Template Library). –≠—Ç–æ –≤—Å–µ–≥–æ-–Ω–∞–≤—Å–µ–≥–æ –Ω–∞–±–æ—Ä —à–∞–±–ª–æ–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ C++, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö Microsoft –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è COM-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤. –û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ COM-–æ–±—ä–µ–∫—Ç—ã, —Å–µ—Ä–≤–µ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ OLE –∏ —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã ActiveX. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Å–≤–æ–µ–π —Å–µ—Å—Ç—Ä—ã WTL, –æ–Ω–∞ –≤—Ö–æ–¥–∏—Ç –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –ø–æ—Å—Ç–∞–≤–∫—É Visual Studio, –Ω–∞–¥–æ —Ç–æ–ª—å–∫–æ –Ω–µ –∑–∞–±—ã—Ç—å –µ—ë –æ—Ç–º–µ—Ç–∏—Ç—å –≤ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–µ.

![atl00](img/atl00.png)

–í Visual Studio –µ—Å—Ç—å ¬´–≤–æ–ª—à–µ–±–Ω–∏–∫–∏¬ª –¥–ª—è ATL, –ø–æ–∑–≤–æ–ª—è—é—â–∏–µ —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–∏—á–Ω—É—é –æ–±—ä–µ–∫—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –±–µ–∑ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä—É—á–Ω—É—é. –û—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞ –ª–∏—à—å —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–∑—ã–≤–∞—Ç—å –∏—Ö –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ, –∏ –≤ –∫–æ–Ω—Ü–µ –∫–æ–Ω—Ü–æ–≤ –Ω–∞–ø–æ–ª–Ω–∏—Ç—å —Å–∫–µ–ª–µ—Ç ¬´–º—è—Å–æ–º¬ª, —Ç. –µ. —Ä–∞–±–æ—á–∏–º –∫–æ–¥–æ–º.

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π ¬´Hello World¬ª –¥–ª—è ATL –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ –ø—Ä–æ—Å—Ç–µ–π—à–µ–≥–æ COM-—Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞, —É–º–µ—é—â–µ–≥–æ —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å —á–∏—Å–ª–∞) –∏ –∫–ª–∏–µ–Ω—Ç–∞ –∫ –Ω–µ–º—É.

–ò—Ç–∞–∫, –ø—Ä–∏—Å—Ç—É–ø–∏–º! –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—ë–º –ø—É—Å—Ç–æ–π —Å–æ–ª—é—à–Ω, –∞ –≤ –Ω—ë–º ‚Äî –ø—Ä–æ–µ–∫—Ç —Ç–∏–ø–∞ ¬´ATL Project¬ª, –Ω–∞–∑—ã–≤–∞–µ–º –µ–≥–æ `FirstLibrary`.

![atl01](img/atl01.png)

–í ¬´–≤–æ–ª—à–µ–±–Ω–∏–∫–µ¬ª –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å –Ω–µ –Ω–∞–¥–æ, —Ä–∞–∑–≤–µ —á—Ç–æ —É–∫–∞–∑–∞—Ç—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç —Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å—Å—è –≤ DLL.

![atl02](img/atl02.png)

–ù–µ –∑–∞–±—É–¥—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ—Ç—å –ª–∏–Ω–∫—ë—Ä, —á—Ç–æ–±—ã –æ–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª –ø–æ–ª—É—á–∞–µ–º—ã–µ COM-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞ –Ω–µ —Å–∏—Å—Ç–µ–º—ã. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –Ω–µ –æ—Ç–≤–ª–µ–∫–∞—Ç—å—Å—è –Ω–∞ —Ä—É–≥–∞—á–∫–∏ Windows.

![atl03](img/atl03.png)

–î–æ–±–∞–≤–ª—è–µ–º –≤ –ø—Ä–æ–µ–∫—Ç ¬´ATL Simple Object¬ª —Å –∏–º–µ–Ω–µ–º Calculator.

![atl04](img/atl04.png)

–í–æ–ª—à–µ–±–Ω–∏–∫ –≤—Å—ë —É–≥–∞–¥—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–∞–º –æ—Å—Ç–∞—ë—Ç—Å—è –ª–∏—à—å –≤–≤–µ—Å—Ç–∏ –ø–æ—è—Å–Ω–µ–Ω–∏—è.

![atl05](img/atl05.png)

–ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ Class View, —Ç–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–∏–¥–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ COM-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏: –º–æ–¥—É–ª—å `CFirstLibraryModule`, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `ICalculator` –∏ –∫–ª–∞—Å—Å `CCalculator`.

![atl06](img/atl06.png)

–©—ë–ª–∫–∞–µ–º –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏ –ø–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É `ICalculator` (–∏–º–µ–Ω–Ω–æ –ø–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É, –∞ –Ω–µ –ø–æ –∫–ª–∞—Å—Å—É!) –∏ –≤—ã–±–∏—Ä–∞–µ–º –ø—É–Ω–∫—Ç ¬´Add method‚Ä¶¬ª –í—Å–ø–ª—ã–≤–∞–µ—Ç –∫—Ä–∞–π–Ω–µ –ø–æ–ª–µ–∑–Ω—ã–π ¬´–í–æ–ª—à–µ–±–Ω–∏–∫¬ª, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–µ–∑ —É—Ç–æ–º–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ª–∞–∑–∞–Ω–∏—è –ø–æ —Ä–∞–∑–Ω—ã–º —Ñ–∞–π–ª–∞–º.

![atl07](img/atl07.png)

–í–æ–ª—à–µ–±–Ω–∏–∫ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–º—ë–Ω, —á—Ç–æ–±—ã —Å–∞–º –¥–æ–±–∞–≤–ª—è—Ç—å –∞—Ç—Ä–∏–±—É—Ç—ã `[in]` –∏ `[out, retval]` –∫ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º. –ü–∞—Ä—É —Ä–∞–∑ —â—ë–ª–∫–Ω—É–ª–∏ –º—ã—à–∫–æ–π –Ω–∞ ¬´Add method‚Ä¶¬ª ‚Äî –ø–æ–ª—É—á–∏—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –±–æ–ª–≤–∞–Ω–∫—É –∫–ª–∞—Å—Å–∞ –∏ —Ä–∞—Å–ø–∏—à–∏—Ç–µ—Å—å.

![atl08](img/atl08.png)

–ù–∞–º –æ—Å—Ç–∞—ë—Ç—Å—è –ª–∏—à—å –∑–∞–π—Ç–∏ –≤ —Ñ–∞–π–ª Calculator.cpp –∏ –Ω–∞–ø–æ–ª–Ω–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞.

```c++
// Calculator.cpp : Implementation of CCalculator
 
#include "pch.h"
#include "Calculator.h"
 
// CCalculator
 
STDMETHODIMP CCalculator::Add (LONG left, LONG right, LONG* result)
{
    *result = left + right;
 
    return S_OK;
}
 
STDMETHODIMP CCalculator::Multiply (LONG left, LONG right, LONG* result)
{
    *result = left * right;
 
    return S_OK;
}
```

–°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —ç—Ç–æ–º –∑–∞–∫–æ–Ω—á–µ–Ω–æ. –ü—Ä–æ–±—É–µ–º —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏ —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ Visual Studio –ø—Ä–µ—Ç–µ–Ω–∑–∏–π –Ω–µ –∏–º–µ–µ—Ç. –û—Å—Ç–∞—ë—Ç—Å—è –ª–∏—à—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —à—Ç—Ä–∏—Ö. –î–æ–±–∞–≤–ª—è–µ–º Post-build step –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞: –Ω–∞–º –Ω–∞–¥–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å TLB-—Ñ–∞–π–ª –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è ‚Äî —Ç–∞–∫ —É–¥–æ–±–Ω–µ–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –ø—Ä–æ–µ–∫—Ç, –æ–Ω –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –∑–Ω–∞—Ç—å, –≥–¥–µ –Ω–∞–π—Ç–∏ TLB. –î–∞ –∏ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —É–ø–∞–∫–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ç–∞–∫ –ø—Ä–æ—â–µ, –∫–æ–≥–¥–∞ –≤—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ. –£–º–∞ –Ω–µ –ø—Ä–∏–ª–æ–∂—É, –ø–æ—á–µ–º—É –¥–æ —Å–∏—Ö –ø–æ—Ä —ç—Ç–æ—Ç —à–∞–≥ –Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω.

![atl09](img/atl09.png)

–ò—Ç–∞–∫, —Å–µ—Ä–≤–µ—Ä —É –Ω–∞—Å –µ—Å—Ç—å. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∫–ª–∏–µ–Ω—Ç—É. –°–æ–∑–¥–∞—ë–º –ø—Ä–æ–µ–∫—Ç —Ç–∏–ø–∞ ¬´Windows Desktop Wizard¬ª –∏ –Ω–∞–∑—ã–≤–∞–µ–º –µ–≥–æ `FirstClient`.

![atl10](img/atl10.png)

–í–æ–ª—à–µ–±–Ω–∏–∫ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–≥–∞–¥–∞–ª.

![atl11](img/atl11.png)

–õ—É—á—à–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É –ø—Ä–æ–µ–∫—Ç–∞–º–∏, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ —Å–µ—Ä–≤–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–ª–∏—Å—å –≤ –∫–ª–∏–µ–Ω—Ç–µ.

![atl12](img/atl12.png)

–ü–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ–º Visual Studio, –≥–¥–µ –∏—Å–∫–∞—Ç—å TLB-—Ñ–∞–π–ª.

![atl13](img/atl13.png)

–í `FirstClient.cpp` –ø–∏—à–µ–º –ø—Ä–æ—Å—Ç–µ—Ü–∫–∏–π –∫–æ–¥:

```c++
// FirstClient.cpp : This file contains the 'main' function. 
// Program execution begins and ends there.
 
#include <windows.h>
#include <iostream>
 
#import "FirstLibrary.tlb"
 
int main()
{
    // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–¥—Å–∏—Å—Ç–µ–º—É COM
    CoInitialize (nullptr);
 
    {
        // –ø–æ–ª—É—á–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –æ–±—ä–µ–∫—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
        FirstLibraryLib::ICalculatorPtr 
            calculator (__uuidof(FirstLibraryLib::Calculator));
 
        // –ø–µ—Ä–≤—ã–π –∏ –≤—Ç–æ—Ä–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–ª—è –º–µ—Ç–æ–¥–æ–≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
        LONG left = 10, right = 15;
 
        // —Å–∫–ª–∞–¥—ã–≤–∞–µ–º —á–∏—Å–ª–∞        
        std::cout << left << " + " << right << " = "
            << calculator->Add (left, right) << std::endl;
 
        // –ø–µ—Ä–µ–º–Ω–æ–∂–∞–µ–º —á–∏—Å–ª–∞
        std::cout << left << " * " << right << " = "
            << calculator->Multiply (left, right) << std::endl;
 
        // –æ–±—ä–µ–∫—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥—ë–Ω
        // –ø–æ –≤—ã—Ö–æ–¥—É –∏–∑ –¥–∞–Ω–Ω–æ–≥–æ –±–ª–æ–∫–∞
    }
 
    // –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–æ–¥—Å–∏—Å—Ç–µ–º—É COM
    CoUninitialize();
}
```

–ù–∞ –¥–≤–æ—Ä–µ 2020 –≥–æ–¥, –∞ Visual Studio –≤—Å—ë –µ—â—ë –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ç—É–ø–∏—Ç—å –∏ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—Ç—å –∫—Ä–∞—Å–Ω—ã–º –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –∫—É—Å–∫–∏ –ø–ª—é—Å–æ–≤–æ–≥–æ –∫–æ–¥–∞. –ü–æ—Ö–æ–∂–µ, –≤ Microsoft –¥–∞–≤–Ω–æ –º–∞—Ö–Ω—É–ª–∏ —Ä—É–∫–æ–π –Ω–∞ –ø–æ–¥–æ–±–Ω—ã–µ –≥–ª—é–∫–∏. üôÅ

![atl14](img/atl14.png)

–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –∫—Ä–∞—Å–Ω–æ—Ç—É –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ, –∫–æ–¥ —É—Å–ø–µ—à–Ω–æ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è. –ó–∞–ø—É—Å–∫–∞–µ–º, —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç.

![atl15](img/atl15.png)
